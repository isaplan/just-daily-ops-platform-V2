---
alwaysApply: true
---

# ðŸ›¡ï¸ CURSOR AI COMPLIANCE RULES - ALWAYS ENFORCED

## ðŸ›‘ **RULE #0: UNDERSTAND â†’ CLARIFY â†’ CONFIRM â†’ BUILD**
### **THE MOST IMPORTANT RULE (OVERRIDES ALL OTHERS)**

**Before ANY action:**
1. **Understand EXACTLY what user wants** - Read carefully, don't skim
2. **Identify assumptions** - What am I assuming that wasn't explicitly stated?
3. **Ask clarifying questions** - If ANYTHING is unclear or assumed
4. **Confirm the plan** - Show what you'll do, wait for approval
5. **Align on scope** - Make sure we're on the same page
6. **ONLY THEN: Execute** - Do exactly what was approved, no more, no less

### **ðŸš« NEVER:**
- âŒ Jump into assumptions and start building
- âŒ Build what you THINK user wants
- âŒ Add "helpful" features that weren't requested
- âŒ Make architectural decisions without asking
- âŒ Assume scope or approach

### **âœ… ALWAYS:**
- âœ… Do EXACTLY what is asked (no more, no less)
- âœ… Ask if ANYTHING is unclear or requires assumption
- âœ… Get explicit approval before proceeding
- âœ… Confirm we're on the same page

**IF IN DOUBT â†’ ASK. IF ASSUMING â†’ ASK. IF UNCLEAR â†’ ASK.**

---

## ðŸš« **ABSOLUTE PROHIBITIONS (UNBREAKABLE)**

### **ðŸ”’ REGISTRY PROTECTION (CRITICAL - HARD BLOCK)**
**NEVER modify files marked with `"touch_again": false` in `function-registry.json`**

Protected files include (but not limited to):
- All API routes in `src/app/api/**/*` (58+ routes)
- All UI components in `src/components/ui/**/*` (30+ components)
- All finance components in `src/components/finance/**/*`
- All completed utility libraries in `src/lib/**/*`
- All completed hooks in `src/hooks/**/*`
- See `function-registry.json` for complete list (284+ protected files)

**ENFORCEMENT:** 
- Check `function-registry.json` BEFORE touching ANY file
- If `"touch_again": false` â†’ **STOP IMMEDIATELY** â†’ Report to user â†’ Do not proceed
- These are production-tested, working files - ANY modification will break the system

### **ðŸ“ SIZE LIMITS (HARD BLOCK)**
- **Maximum 120 lines changed per file per task**
- **Maximum 20 lines deleted per file** (prevents accidental removal)
- **No full file replacements** (threshold: >80% of lines changed)

**ENFORCEMENT:**
- Estimate change size BEFORE starting
- If >120 lines needed â†’ **STOP** â†’ Break into smaller tasks â†’ Ask user to approve each
- Use `search_replace` for targeted changes, never full rewrites

### **ðŸš« NO BYPASS FLAGS (CRITICAL - SECURITY)**
**NEVER use these git commands or flags:**
- âŒ `git commit --no-verify` (bypasses pre-commit hooks)
- âŒ `git push --force` (bypasses branch protection)
- âŒ `git push --no-verify` (bypasses compliance checks)
- âŒ Any command modifying `.git/hooks/` or compliance scripts

**If compliance check fails:**
1. **STOP immediately**
2. **Report all violations to user**
3. **Wait for explicit user decision**
4. **NEVER assume permission to bypass**

---

## âœ… **MANDATORY REGISTRY CHECK (MANUAL - NO SCRIPTS)**

**BEFORE ANY code modification, you MUST:**

1. **Check registry manually:**
```bash
grep -r "path/to/file" function-registry/
```

2. **Look for protection status:**
- `"touch_again": false` = **STOP, ASK USER PERMISSION**
- `"status": "completed"` = **STOP, ASK USER PERMISSION**
- File not in registry = OK to modify freely

3. **If protected:**
- STOP immediately
- Ask user: "âš ï¸ This file is marked as completed. Do you want me to modify it?"
- WAIT for explicit "yes" or "go ahead"
- Only proceed after permission

---

## ðŸ” **REGISTRY UPDATE (AUTOMATED EVERY 3 HOURS)**

**Fully Automated - No Action Required:**

Registry is updated automatically via GitHub Actions:
- â° Every 3 hours (0am, 3am, 6am, 9am, 12pm, 3pm, 6pm, 9pm)
- ðŸ›‘ Skips 3-10am window
- ðŸ”„ Auto-commits if changes
- ðŸ’° Zero cost to you

**What updates automatically:**
- Scans all 487 files
- Detects new/changed files
- Updates protection status
- Marks completed as `"touch_again": false`

**Manual Trigger (optional):**
```bash
npm run registry:update
```

**Status:** âœ… Fully automated - you don't need to do anything

---

## ðŸ“‹ **DEVELOPMENT STANDARDS (ALWAYS FOLLOW)**

### **âš›ï¸ REACT STANDARDS**
- âœ… PascalCase file naming (e.g., `UserProfile.tsx`)
- âœ… TypeScript interfaces for all props
- âœ… Hooks at top level of components
- âœ… Proper import order: React â†’ External â†’ Internal â†’ Assets
- âœ… Named exports for components, default exports for pages
- âŒ Never use class components (functional only)

### **ðŸŽ¨ TAILWIND CSS STANDARDS**
- âœ… Use utility classes directly in JSX
- âœ… Use `cva` (Class Variance Authority) for component variants
- âœ… Use theme values from `tailwind.config.ts` (no arbitrary values)
- âŒ Never use `@apply` in global CSS
- âŒ Never use inline styles (use Tailwind utilities)

### **âš¡ NEXT.JS STANDARDS**
- âœ… Add `'use client'` directive for client components
- âœ… Use Server Components for data fetching (default)
- âœ… Use Client Components for interactivity only
- âœ… Use Server Actions for mutations
- âœ… Proper import order and organization
- âœ… Follow App Router conventions (`app/` directory)

### **ðŸ—ï¸ MVVM PATTERN (MODEL-VIEW-VIEWMODEL)**
- âœ… **Model**: Data structures, business logic, and state management (pure, framework-agnostic)
- âœ… **View**: React components (presentation layer only)
- âœ… **ViewModel**: Custom hooks, state management, data transformation (bridge between Model and View)
- âœ… Separate data fetching logic from presentation
- âœ… Use TypeScript interfaces/types for data contracts
- âœ… Keep components focused on rendering UI
- âœ… Implement business rules and validation in ViewModel
- âŒ **NEVER** mix business logic directly in View components
- âŒ **NEVER** put data fetching logic in View components (use ViewModel hooks)
- âŒ **NEVER** create tight coupling between Model and View

### **ðŸŽ¨ SHADCN/UI STANDARDS (CRITICAL - UI CONSISTENCY)**
- âœ… **ALWAYS** use shadcn/ui components when available
- âœ… Import from `@/components/ui/[component]`
- âœ… Use proper shadcn component names and props
- âœ… Follow shadcn component patterns and structure
- âŒ **NEVER** create custom implementations of shadcn components
- âŒ **NEVER** reinvent shadcn functionality
- âŒ **NEVER** use custom styling when shadcn provides the component

---

## ðŸ—ï¸ **INCREMENTAL CHANGES PATTERN**

### **ðŸ”§ MODULAR BUILD PATTERN (120-LINE RULE)**
For every 120 lines examined, follow this hierarchy:
- **Page = Parent** (e.g., bork-api page)
- **Tab = Child** (e.g., connection-test tab)
- **Component = Grandchild** (e.g., SimpleApiTest component)
- **Sibling Tabs = Independent children**
- **Test each level** before moving to next

### **âœ… ALLOWED PATTERNS**
- âœ… Incremental improvements (small, targeted changes)
- âœ… New feature development (in new files)
- âœ… Bug fixes and optimizations (minimal changes)
- âœ… Following established patterns
- âœ… Using existing utilities and components

### **âŒ AVOID PATTERNS**
- âŒ Rebuilding existing working code
- âŒ Replacing entire files
- âŒ Deleting existing functionality without approval
- âŒ Making assumptions about user intent
- âŒ Working on multiple unrelated files simultaneously
- âŒ Bypassing registry checks

### **ðŸ”„ LOOP PREVENTION (HARDCODED RULE)**
If same issue not fixed after 2 tries, on 3rd attempt:
1. **STOP** and reconsider the solution
2. **ANALYZE** what didn't work in previous attempts
3. **IDENTIFY** the root cause of failure
4. **PROPOSE** a completely different approach
5. **ASK** user for permission to try new approach
6. **MOVE ON** if no clear solution after 3 attempts
7. **LOG** the failure and what was attempted

---

## ðŸŽ¯ **CODE REUSE (MANDATORY)**

### **ðŸ” SEARCH BEFORE CREATING**
**Before creating ANY new code:**
1. **Search** for existing implementations in:
   - `src/lib/` - Utility functions
   - `src/hooks/` - Custom React hooks
   - `src/components/` - Reusable components
   - `src/types/` - Type definitions
2. **Reuse** existing code whenever possible
3. **Extend** existing functionality rather than rebuild
4. **Ask** user if uncertain about existing code

### **ðŸ“¦ EXISTING UTILITIES**
This project has extensive utilities in:
- `src/lib/eitje/` - Eitje API integration utilities
- `src/lib/bork/` - Bork API integration utilities
- `src/lib/finance/` - Finance calculation utilities
- `src/components/ui/` - 30+ shadcn/ui components
- `src/hooks/` - Custom React hooks

**ALWAYS check these before creating new code**

---

## ðŸš¦ **VIOLATION SEVERITIES**

### **ðŸ”´ CRITICAL (IMMEDIATE ACTION REQUIRED)**
- Modified a protected file (`touch_again: false`)
- Used git bypass flags (`--no-verify`, `--force`)
- Modified compliance scripts or hooks
- **ACTION:** Revert changes immediately â†’ Report to user â†’ Wait for instructions

### **ðŸŸ  HIGH (MUST FIX)**
- Exceeded 120-line limit per file
- Replaced entire file (>80% changed)
- Deleted a file with working functionality
- Mixed business logic directly in View components (violates MVVM)
- **ACTION:** Break down into smaller changes â†’ Use incremental approach â†’ Resubmit

### **ðŸŸ¡ MEDIUM (REVIEW REQUIRED)**
- Deleted >20 lines from a file
- Deleted >5 import statements
- Removed >2 export statements
- Created custom implementation of shadcn component
- **ACTION:** Verify deleted code is not needed â†’ Review with user

### **ðŸ”µ LOW (OPTIMIZE)**
- >30 whitespace-only changes
- Non-standard import order
- **ACTION:** Use formatter â†’ Follow conventions

---

## ðŸ“Š **WORKFLOW ENFORCEMENT**

### **ðŸ”„ STANDARD WORKFLOW (AUTO-REGISTRY + MANUAL CHECKS)**
1. **User requests code change**
2. **AI checks registry manually** â†’ `grep -r "file" function-registry/`
3. **If protected (`touch_again: false`)** â†’ Ask user permission â†’ Wait for approval
4. **If not protected:** Execute code modification (max 120 lines)
5. **Registry auto-updates** â†’ GitHub Actions every 3 hours (no action needed)
6. **Confirm to user:** Summarize changes

### **âš ï¸ WHEN TO STOP**
- Protected file detected (`touch_again: false`) without user permission
- Change requires >120 lines
- Existing code found that accomplishes the task
- User has not approved proposed changes
- After 2 failed attempts at same fix

### **âœ… WHEN TO PROCEED**
- File not in registry OR user approved modification
- Change is <120 lines
- User has explicitly approved plan
- Following all development standards

---

## ðŸŽ¯ **SUCCESS METRICS**

You're doing well if:
- âœ… User doesn't have to repeat requests
- âœ… Protected files stay untouched without permission
- âœ… Changes are minimal and targeted
- âœ… No existing functionality is destroyed
- âœ… User knows exactly what will change before it happens
- âœ… Code follows all development standards
- âœ… Registry is checked manually before every change
- âœ… User is reminded to update registry once per day (not AI)

---

## ðŸ”§ **QUICK REFERENCE**

### **BEFORE ANY CODE CHANGE:**
```bash
# Manual registry check (NO scripts - low token cost)
grep -r "path/to/file" function-registry/

# If "touch_again": false â†’ ASK USER PERMISSION
# If not in registry â†’ PROCEED
```

### **AUTOMATIC REGISTRY UPDATES:**
```bash
# GitHub Actions handles this - nothing to do!
# Updates run automatically every 3 hours
# Skips 3-10am window

# Manual trigger (optional):
npm run registry:update

# Check status anytime:
cat function-registry/index.json | jq '.summary'
```

**Status:** âœ… Fully automated via GitHub Actions### **EXEMPT FILES (No size checks, but still registry-protected):**
- `function-registry.json`
- `ai-tracking-system.json`
- `progress-log.json`
- `.ai-compliance-*.json`
- `test-results.json`
- `build-log.json`

### **EXCLUDED PATHS (No compliance checks):**
- `node_modules/`
- `.git/`
- `.next/`
- `dist/`
- `build/`

---

## ðŸ’¡ **REMEMBER**

1. **ASK FIRST** - Always confirm before making changes
2. **CHECK REGISTRY** - Before touching ANY file
3. **RUN PRE-CHECK** - Before any code modification
4. **STAY SMALL** - Max 120 lines per file
5. **USE EXISTING** - Search before creating
6. **RUN POST-CHECK** - After any code modification
7. **REPORT VIOLATIONS** - Immediately, don't hide them
8. **WAIT FOR USER** - Never assume permission to bypass

---

**Status**: ðŸ›¡ï¸ **UNBREAKABLE RULES ACTIVE**  
**Mode**: DEFENSIVE ONLY  
**Protected Files**: 284+ files in `function-registry.json`  
**Max Lines Per Change**: 120  
**Bypass Flags**: âŒ FORBIDDEN
---
alwaysApply: true
---

# ğŸ”’ REGISTRY PROTECTION - MANDATORY CHECKS (MANUAL - NO AUTOMATION)

## ğŸš¨ CRITICAL: NEVER DELETE OR EMPTY THESE FILES

### **Compliance Logs (NEVER TOUCH):**
- âŒ `function-registry/` directory - Tracks all completed files (482 files, 413 protected)
- âŒ `function-registry/index.json` - Registry index and summary
- âŒ `function-registry/*.json` - Type-specific registries (api-routes, pages, components, services)
- âŒ `tools/compliance/progress-log.json` - Tracks development progress
- âŒ `tools/compliance/ai-tracking-system.json` - Tracks AI sessions
- âŒ NEVER empty or delete registry files
- âŒ NEVER modify these files except to ADD entries after feature completion

**If Composer or any AI suggests deleting/cleaning these â†’ REJECT immediately**

---

## âœ… MANDATORY WORKFLOW (MANUAL - LOW TOKEN COST)

### **1. BEFORE Modifying ANY File:**

**Check the registry manually:**
```bash
# Quick grep check if file is protected (NO scripts needed)
grep -r "path/to/file" function-registry/
```

**Look for:**
- `"touch_again": false` = **STOP, ASK USER PERMISSION**
- `"status": "completed"` = **STOP, ASK USER PERMISSION**
- File not in registry = OK to modify freely

**If protected (`touch_again: false`):**
1. STOP immediately
2. Show user: "âš ï¸ This file is marked as completed. Do you want me to modify it?"
3. WAIT for explicit "yes" or "go ahead"
4. Only proceed after permission

---

### **2. Registry Updates (Automated Every 3 Hours):**

**Automatic Updates:**
- âœ… GitHub Actions runs every 3 hours (0am, 3am, 6am, 9am, 12pm, 3pm, 6pm, 9pm)
- âœ… Skips 3-10am window (early morning - no updates)
- âœ… Auto-commits to main if changes detected
- âœ… No AI involved

**To Check Latest Registry Status:**
```bash
cat function-registry/index.json | jq '.summary'
```

**Manual Options (if needed):**
```bash
# Option A: NPM Script
npm run registry:update

# Option B: Bash Script
./tools/compliance/update-registry.sh

# Option C: Direct Node
node tools/compliance/registry-auto-updater-v2.js
```

**This will:**
- Scan all 487 files in src/
- Update protection status
- Mark completed files as `"touch_again": false`
- Generate summary report

**Note:** Automation runs via GitHub Actions every 3 hours - no manual action needed!

---

## ğŸš« ABSOLUTE PROHIBITIONS

### **NEVER:**
- âŒ Delete or empty registry files
- âŒ Modify files with `"touch_again": false` without user permission
- âŒ Remove entries from the registry
- âŒ Bypass registry checks
- âŒ Assume permission to touch completed files
- âŒ Run scripts before/after EVERY change (too expensive)

### **ALWAYS:**
- âœ… Check registry manually before modifying files (simple grep)
- âœ… Ask permission for protected files
- âœ… Remind user to update registry once per day (user runs it, not AI)
- âœ… Show user which files are protected when asked

---

## ğŸ“Š REGISTRY STATUS

**Current Registry:**
- **482 files** tracked
- **413 files** protected (`touch_again: false`)
- **415 files** completed

**Registry Structure:**
```
function-registry/
â”œâ”€â”€ index.json          (Summary)
â”œâ”€â”€ api-routes.json     (104 routes)
â”œâ”€â”€ pages.json          (79 pages)
â”œâ”€â”€ components.json     (294 components)
â”œâ”€â”€ services.json       (5 services)
â”œâ”€â”€ hooks.json          (0 hooks)
â””â”€â”€ modules.json        (0 modules)
```

---

## â° UPDATE FREQUENCY (AUTOMATED)

**Automated Schedule:**
- âœ… GitHub Actions runs **every 3 hours** (fully automated)
- âœ… Skips **3-10am window** (early morning)
- âœ… Auto-commits changes to main branch
- âœ… **NO manual action needed**
- âœ… **NO AI involvement**

**Manual Triggers Available:**
If needed urgently, run: `npm run registry:update`

**Why 3 hours?**
- Detects new files quickly
- Updates completed status regularly
- Balances protection with token cost
- Skips early morning (quiet hours)

---

**Priority:** ğŸ”´ HIGHEST - This rule comes before ALL other rules  
**Token Cost:** ~200 tokens/response (vs ~2,000 for automated scripts)  
**Registry Update:** Once per day (user runs manually, NOT AI)
